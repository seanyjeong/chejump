<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>모든 학생의 학교별 점수 보기</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #dddddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <h1>모든 학생의 학교별 점수</h1>
  <button onclick="loadScores()">점수 불러오기</button>
  <div id="loading" style="display: none;">로딩 중...</div>
  <table id="scoresTable" style="display: none;">
    <thead>
      <tr>
        <th>학생 이름</th>
        <th>학교명</th>
        <th>전공</th>
        <th>총점</th>
      </tr>
    </thead>
    <tbody>
      <!-- 점수 데이터가 여기에 삽입됩니다. -->
    </tbody>
  </table>
  <script>
    function loadScores() {
      const loadingIndicator = document.getElementById('loading');
      const scoresTable = document.getElementById('scoresTable');
      const tbody = scoresTable.querySelector('tbody');

      loadingIndicator.style.display = 'block';
      scoresTable.style.display = 'none';
      tbody.innerHTML = '';  // 기존 데이터를 초기화

      fetch('https://supermax.kr/api/calculate-scores-for-all-students')
        .then(response => response.json())
        .then(data => {
          loadingIndicator.style.display = 'none';
          scoresTable.style.display = 'table';

          data.forEach(student => {
            const nameRow = document.createElement('tr');
            nameRow.innerHTML = `
              <td rowspan="${student.scores.length}">${student.studentName}</td>
              <td>${student.scores[0].학교명}</td>
              <td>${student.scores[0].전공}</td>
              <td>${student.scores[0].totalScore}</td>
            `;
            tbody.appendChild(nameRow);

            for (let i = 1; i < student.scores.length; i++) {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${student.scores[i].학교명}</td>
                <td>${student.scores[i].전공}</td>
                <td>${student.scores[i].totalScore}</td>
              `;
              tbody.appendChild(row);
            }
          });
        })
        .catch(error => {
          console.error('점수 불러오기 오류:', error);
          loadingIndicator.style.display = 'none';
          alert('점수 불러오기에 실패했습니다. 콘솔을 확인해주세요.');
        });
    }
  </script>
</body>
</html>
